apiVersion: v1
kind: Namespace
metadata:
  name: aws-observability
  labels:
    aws-observability: enabled

---
kind: ConfigMap
apiVersion: v1
metadata:
  name: aws-logging
  namespace: aws-observability
data:
  output.conf: |
    [OUTPUT]
      Name  es
      Match *user*
      Host  $ELK_URL
      Port  9200
      Index users-eks

    [OUTPUT]
      Name  es
      Match *flight*
      Host  $ELK_URL
      Port  9200
      Index flights-eks

    [OUTPUT]
      Name  es
      Match *booking*
      Host  $ELK_URL
      Port  9200
      Index bookings-eks

    [OUTPUT]
      Name  es
      Match *kube*
      Host  $ELK_URL
      Port  9200
      Index kube-eks

  parsers.conf: |
    [PARSER]
      Name                  spring
      Format                regex
      Regex                 ^(?<aws>.* F)\s+(?<time>\d{4}-\d{1,2}-\d{1,2} \d{1,2}:\d{1,2}:\d{1,2}.\d{3})\s+(?<level>[^\s]+)\s+(?<pid>\d+).*?\[(?<thread>.*)\]\s+(?<class>.*)\s+:\s+(?<message>.*)
      Time_Key              time
      Time_Format           %Y-%m-%dT%H:%M:%S.%L%z

  filters.conf: |
    [FILTER]
      Name                  kubernetes
      Match                 kube.*
      Merge_Log             On
      Buffer_Size           0
      Kube_Meta_Cache_TTL   300s