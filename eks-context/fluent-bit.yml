apiVersion: v1
kind: Namespace
metadata:
  name: aws-observability
  labels:
    aws-observability: enabled

---
kind: ConfigMap
apiVersion: v1
metadata:
  name: aws-logging
  namespace: aws-observability
data:
  output.conf: |
    [OUTPUT]
      Name                cloudwatch_logs
      Match               *
      region              us-east-2
      log_group_name      /eks/ap-logs/dev
      log_stream_prefix   kubernetes['labels']['app.kubernetes.io/name']
      auto_create_group   true
      log_key log

  parsers.conf: |
    [PARSER]
      Name                  spring
      Format                regex
      Regex                 ^(?<time>[^ ]+) (?<stream>stdout|stderr) (?<logtag>P|F) (?<log>.*)$
      Time_Key              time
      Time_Format           %Y-%m-%dT%H:%M:%S.%L%z

  filters.conf: |
    [FILTER]
      Name parser
      Match *
      Key_name log
      Parser spring